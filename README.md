# scenes

4年前上家公司使用传统指纹考勤；
3年前同事开发打卡app免去了排队烦恼：
![打卡app](/public/app_concat_640.jpg?raw=true "打卡app")

现在我用机器学习实现全自动打卡，tensorflow训练一个CNN模型教它看图认识不同地方，就像教小孩子看图认识猫、狗、鱼、虫，让机器软件拥有认知能力。

全自动打卡效果是早晚开车经过公司楼下被程序识别进行打卡操作。区别于传统if else硬编码程序，卷积神经网络的魅力在于能够像人一样学习增强，伴随经验积累机器对事物认知判断更准确，alphaGO学下棋从业余棋手到世界第一只花2年碾压人类几千年经验智慧就证明了机器可以做得比人好。

经过构思，我先Google搜索资料查阅了tensorflow的使用方法，并且在笔记本上成功训练一个模型识别不同图片，于是买了一个手机支架把闲置nexus5固定到车子挡风玻璃用于拍摄道路前方路况，买了一块raspberry pi3训练CNN模型及执行识别场景。 


一、准备工作：


1、组装raspberry pi3，刷入ubuntu mate，编译安装node.js、jdk、python3、tensorflow、opencv3等工具环境，树莓派运行慢，编译往往花费好几小时。
2、给闲置nexus5安装一款“IP Webcam”：
利用“IP Webcam”让nexus5充当一款网络摄像头，可以用python通过opencv接口实时捕获视频图像，python代码把视频解析成一帧一帧的图片进行处理。
3、收集训练数据

把nexus5手机固定到车上：

 

打开iphone热点，让nexus5、笔记本同时连接iphone热点使得它们处于同一局域网，笔记本里python代码保存nexus5摄像头捕获到的图片，把车开到公司楼下像平常上下班走一遍，收集到tensorflow所需训练数据。



  二、人工标记数据

 训练CNN卷及神经网络采用监督式学习，先把收集到的原始图片从640*480批量resize成128*96，这样做为了减少tensorflow计算量，否则量大会导致程序无法运行，所以只需要很低分辨率的图片就可以了。

接着标记数据，普通道路场景图片批量加上“-0”标记，写个python脚本很容易实现，再人工挑选出公司楼下比较有特征的场景图片，加上“-1”标记：

最终大概有3000多张图片，“-0”表示普通道路场景，占多数，“-1”表示上班公司楼下入口，“-2”表示下班公司楼下南门出口，“-3”表示下班公司楼下北门出口，“-4”表示晚上天黑了停车库出口。


三、训练卷及神经网络模型


3000多张图片，每次放入10张进行训练，循环训练40批次，最初loss很大，慢慢减小到0，准确率提高到100%。

训练很耗时，几个小时，完成后模型保存下来等待下次直接使用。



四、添加打卡代码

加上远程调用api接口代码，当CNN模型运行时检测到特征图片自动调用接口实现打卡：

五、实际体验

同样iphone打开热点让raspberry pi、nexus5、笔记本连接，笔记本远程访问raspberry pi实时打印log查看情况，把车开到公司楼下：

作为学习python、tensorflow的helloworld，至此，完成。
